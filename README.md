# SSM_BEP
The scripts are used to compute a Statistical Shape Model (SSM) of any geometry. The code uses the following Python modules: NumPy, Pyssam, Matplotlib, Trimesh, Sklearn, Scipy, Numpy-stl, vtk. Below is a small explanation of all the scripts needed to compute SSM. 

Author: Noah Saad - n.w.saad@student.tudelft.nl (5222117)

Nomenclature: 
- Landmarks: set of points used to describe the geometry. It is defined as the center of the cluster that is generated by Kmeans algorithm for clustering the nodes of the STL file. 
- Reference Landmarks: Set of landmarks that describe the reference geometry, i.e. the geometry that will be used to align all objects.

1) SSM_script.py: 

This is the main script. It concatenates all the landmarks of the objects, such that it is fed into the pyssam module that performs SSM. The script will first give some information such as the number of objects used in the SSM. Second, it displays the average geometry. Third, it plots the cumulative variance of each mode. Finally, it displays a figure with the average geometry and a mode (user specified) with weights that can be chosen in script "Plot_shape_modes.py".
This script uses Pyssam. 
Input: Folder of landmarks of desired objects
Output: Mean geometry txt file, plots of mean shape, modes, and cumulative variance. 

2) landmark_script.py: 

The first function generates a reference landmark to later be used for aligning all objects. It uses K-mean clustering and generates a landmark for centroid of each cluster.
Input: STL file and number of landmarks desired
Output: Landmarks of reference.

The second function generates landmarks in exactly the same way as the first, and performs Procrustes to align the reference with the landmarks. It computes the closest reference points and find the cross covariance matrix between the reference and the closest_ref_points to find a transformation that aligns them. Uses SVD to find the rotation matrices. Furthermore, it ensures that landmarks are one-to-one correspondent by using the Hungarian Algorithm. Finally, returns the landmarks.
Input: STL file to be analyzed, num_landmarks (should be same as reference), and reference landmarks
Output: Landmarks of desired objects aligned with the reference. 

3) generate_landmarks_2_save.py:

Uses 'landmark_script.py' to generate landmarks and saves them in desired path, such that you only need to do this once. 
Input: Reference file (.stl) and folder with all stl files and saving path 
Output: txt file for each object in saving path. 

4) number_cluster_sensitivity.py:

This script can be used to determine how many landmarks to use on an object. It applies the reference landmark function from 'landmark_script.py' for different values of landmarks (user specified). It then plots both the sum squared error (of each landmark to the center of the cluster) as a function of the number of clusters and also the silhouette coefficient as a function of the number of landmarks.
Input: STL file 
Output: Plots of SSE and silhouette coefficient both as functions of number of clusters

5) vtk_2_stl.py: 

Converts a VTK file to a STL file. 

Input: VTK file and saving path
Output: STL file.

6) visualize_landmarks.py:

To be used to vizualize landmarks generated from previous scripts. Uses Open3d to plot. 

Input: landmarks (can be txt files or stl files but they first need to generate landmarks using 'landmark_script.py'
Output: Plot of landmarks in 3D.

7) plot_shape_modes.py: 

Plots the shape modes of the computed SSM. The weights can be manually changed. 

Input: ssm, mean_shape_columnvector, mean_shape, ssm.model_parameters, ssm.pca_model_components, mode_to_plot, saving_path
Output: Plot of mean shape and two weights of selected mode. 

8) plot_cumulative_variance.py:

Plots the cumulative variance of the each SSM mode. 
Input: ssm.pca_object.explained_variance_ratio_ and desired variance
Output: Plot with cumulative variance of each mode.  

9) SSM_script_improved.py:

Uses a own code for SSM and does not make use of PYSSAM. Makes use of the class SSM defined in script "class_SSM.py".

10) alignment_shapes.py:

Code to align shapes after entropy generated landmarks. 





